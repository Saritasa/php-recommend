<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Saritasa recommended packages for PHP</title>
  <link
      rel="stylesheet"
      href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"
      integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u"
      crossorigin="anonymous">

  <script
      src="https://code.jquery.com/jquery-3.3.1.min.js"
      integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
      crossorigin="anonymous">
  </script>

  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"
          integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa"
          crossorigin="anonymous">
  </script>

  <script type="text/javascript" src="yaml0.3.0.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/vue/0.11.10/vue.min.js"></script>

  <style>
    .section {
      margin: 5px auto;
      padding: 10px 20px;
    }
    .section.search-result {
      padding: 10px 40px;
    }
  </style>
  <script>
    var yamlFile = YAML.load('list.yaml');

    function level1(text, noNewLine) {
      if (undefined === noNewLine) {
        return "## " + text + "\r\n";
      }
      return "## " + text;
    }

    function level2(text, noNewLine) {
      if (undefined === noNewLine) {
        return "### " + text + "\r\n";
      }
      return "### " + text;
    }

    function level3(text, noNewLine) {
      if (undefined === noNewLine) {
        return "#### " + text + "\r\n";
      }
      return "#### " + text;
    }

    function formatItem(label, item, noNewLine) {
      var str = "* ";
      str += "[" + label + "]";
      str += "(" + item["url"] + ")";
      if ("description" in item) {
        str += " - " + item["description"];
      }
      if ("explain" in item) {
        str += ' <a href="/#" title="' + item["explain"] + '">:information_source:</a>';
      }

      if (undefined === noNewLine) {
        return str + "\r\n";
      }
      return str;
    }

    function formatHtmlItem(label, item, noNewLine) {
      var desc = "";
      if ("description" in item) {
        desc = " - " + item["description"];
      }
      var exp = "";
      if ("explain" in item) {
        exp = ' <a href="#"><span class="glyphicon glyphicon-comment" title="' + item["explain"] + '"></span></a>';
      }
      var str = `<li><a href='${item["url"]}'>${label}</a>${desc} ${exp}</li>`;

      if (undefined === noNewLine) {
        return str + "";
      }
      return str;
    }
  </script>
</head>

<body>
<div id="app">
  <div class="section title">
    <h1>Saritasa recommended packages for PHP</h1>
  </div>

  <div class="section tag-cloud">
    <div>Tag Cloud</div>
  </div>

  <div class="section search-form">
    <input type="text" id="keyword" placeholder="Search keyword" v-model="keyword">
    <span class="label label-success selected-tag hidden">Tag 1<a><i class="remove glyphicon glyphicon-remove-sign glyphicon-white"></i></a></span>
    <p>{{ keyword }}</p>
  </div>

  <div class="section search-result">

  </div>

  <script>
    new Vue({
      el: '#app',
      data: {
        keyword: '',
      },
      methods: {
        formatMarkdown: function () {
          var markdownString = "";
          var yamlData = yamlFile;
          Object.keys(yamlData).forEach(function(key1){
            // Level 1
            markdownString += level1(key1);
            // Level 2
            Object.keys(yamlData[key1]).forEach(function(key2){
              markdownString += level2(key2);

              // Level 3
              var languageGroups = new Object();
              Object.keys(yamlData[key1][key2]).forEach(function(key3){
                var language = "Other";
                if ("language" in yamlData[key1][key2][key3]) {
                  language = yamlData[key1][key2][key3]["language"];
                }
                if (!(language in languageGroups)) {
                  languageGroups[language] = {};
                }
                // Check url of websites section
                if (key2 === "websites" && !("url" in yamlData[key1][key2][key3])) {
                  yamlData[key1][key2][key3]["url"] = "http://" + key3;
                }

                languageGroups[language][key3] = yamlData[key1][key2][key3];
              });

              // Show items
              Object.keys(languageGroups).forEach(function(keyLang){
                if (key2 !== "packages") {
                  markdownString += level3("_" + keyLang + "_");
                }
                Object.keys(languageGroups[keyLang]).forEach(function(keyItem) {
                  markdownString += formatItem(keyItem, languageGroups[keyLang][keyItem]);
                });
              });
            });
          });

          return markdownString;
        },
        formatHtml: function () {
          var htmlString = "";
          var yamlData = yamlFile;
          Object.keys(yamlData).forEach(function(key1){
            // Level 1
            htmlString += "<h2>" + key1 + "</h2>";
            // Level 2
            Object.keys(yamlData[key1]).forEach(function(key2){
              htmlString += "<h3>" + key2 + "</h3>";

              // Level 3
              var languageGroups = new Object();
              Object.keys(yamlData[key1][key2]).forEach(function(key3){
                var language = "Other";
                if ("language" in yamlData[key1][key2][key3]) {
                  language = yamlData[key1][key2][key3]["language"];
                }
                if (!(language in languageGroups)) {
                  languageGroups[language] = {};
                }
                // Check url of websites section
                if (key2 === "websites" && !("url" in yamlData[key1][key2][key3])) {
                  yamlData[key1][key2][key3]["url"] = "http://" + key3;
                }

                languageGroups[language][key3] = yamlData[key1][key2][key3];
              });

              // Show items
              Object.keys(languageGroups).forEach(function(keyLang){
                if (key2 !== "packages") {
                  htmlString += "<h4><i>" + keyLang + "</i></h4>";
                }
                Object.keys(languageGroups[keyLang]).forEach(function(keyItem) {
                  htmlString += formatHtmlItem(keyItem, languageGroups[keyLang][keyItem]);
                });
              });
            });
          });

          $(".section.search-result").html(htmlString);
        }
      },
      created: function () {
        this.formatHtml();
      },
    });

  </script>
</div>
</body>
</html>
